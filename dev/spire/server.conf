server {
  bind_address = "0.0.0.0"
  bind_port    = "8081"
  trust_domain = "cluster.local"
  data_dir     = "/opt/spire/data/server"
  log_level    = "DEBUG"

  # Place the admin socket on the shared spire-sockets volume so spire-init
  # can call CLI commands (token generate, entry create) without TCP access.
  socket_path  = "/opt/spire/sockets/server.sock"

  # Short TTLs are fine for local dev â€” SVIDs rotate quickly.
  ca_ttl                  = "1h"
  default_x509_svid_ttl  = "1h"
}

plugins {
  DataStore "sql" {
    plugin_data {
      database_type     = "sqlite3"
      connection_string = "/opt/spire/data/server/datastore.sqlite3"
    }
  }

  # join_token attestation: simplest approach for dev; no TPM / cloud required.
  NodeAttestor "join_token" {
    plugin_data {}
  }

  KeyManager "disk" {
    plugin_data {
      keys_path = "/opt/spire/data/server/keys.json"
    }
  }


}

health_checks {
  listener_enabled = true
  bind_address     = "0.0.0.0"
  bind_port        = "8080"
  live_path        = "/live"
  ready_path       = "/ready"
}
